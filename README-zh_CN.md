<h1 align="center">
  go-optioner
</h1>
go-optioner 是一个在 Go 代码中生成函数选项模式代码的工具。该工具可以根据给定的结构定义自动生成相应的选项代码。

---

[English](./README.md) | 中文简体

# 安装
- 1、`go install github.com/chenmingyong0423/go-optioner/cmd/optioner@latest`
- 2、执行 `optioner` 命令检查是否安装成功
```
> optioner
go-optioner is a tool for generating functional options pattern.
Usage: 
         optioner [flags]
Flags:
         -type <struct name>
         -output <output path>, default: srcDir/opt_xxx_gen.go
```
如果你安装成功了，但是提示 `optioner` 命令找不到，请确认是否已将 `$GOPATH/bin` 添加到环境变量中。

# 使用教程
你可以直接使用 `optioner` 命令生成对应结构体的 `functional options` 代码，也可以使用 `go generate` 进行批量生成。
## optioner 命令
- 1、首先，你需要创建一个包含需要生成函数选项模式代码的结构体的 `Go` 文件。在结构体字段中，您可以使用 `opt` 标签来控制是否为 `NewXXX()` 函数的必传参数和生成相应的函数。
```go
package example

type User struct {
	Name   string `opt:"-"`
	Age    int
	Gender string
}

```
如果字段定义了 `opt` 标签，并且值为 `-`，则它将作为 `NewXXX` 函数的必要参数，并且不会生成该字段的 `WithXXX` 函数。

注意：必须声明 `package`。
- 2、在包含结构体定义的文件目录下，执行 `optioner -type XXX` 命令，其中 `XXX` 是结构体的名称。执行命令之后，`optioner` 工具会根据结构体定义生成相应的函数选项模式代码。内容如下所示：
```go
// Generated by go-option -type User; DO NOT EDIT
// If you have any questions, please create issues and submit contributions at:
// https://github.com/chenmingyong0423/go-optioner

package example

type UserOption func(*User)

func NewUser(name string, opts ...UserOption) *User {
	user := &User{
		Name: name,
	}

	for _, opt := range opts {
		opt(user)
	}

	return user
}

func WithAge(age int) UserOption {
	return func(user *User) {
		user.Age = age
	}
}

func WithGender(gender string) UserOption {
	return func(user *User) {
		user.Gender = gender
	}
}

```
`optioner` 工具将会生成一个名为 `opt_xxx_gen.go` 的文件，其中 `xxx` 是结构体的名称，例如 `opt_user_gen.go`。该文件包含生成的函数选项代码，用于初始化结构体和设置结构体字段的值。
## go generate 命令
请注意，在执行 `go generate` 命令之前，确保您的项目已经初始化 `Go Modules` 或正确设置了 `GOPATH`，并且您的项目结构符合 `Go Modules` 或 `GOPATH` 的要求。

- 1、首先，你需要创建一个包含需要生成函数选项模式代码的结构体的 `Go` 文件。在结构体定义之上，你需要添加 `//go:generate optioner -type XXX` 的注释，其中 `XXX` 是结构体的名称。这样工具就能根据参数生成相应的代码。在结构体字段中，您可以使用 `opt` 标签来控制是否为 `NewXXX()` 函数的必传参数和生成相应的函数。
```go
package example

//go:generate go-option -type User
type User struct {
	Name   string `opt:"-"`
	Age    int
	Gender string
}
```
如果字段定义了 `opt` 标签，并且值为 `-`，则它将作为 `NewXXX` 函数的必要参数，并且不会生成该字段的 `WithXXX` 函数。

注意：必须声明 `package`。
- 2、在包含结构体定义的文件目录下，执行 `go generate` 命令，这将调用 `optioner` 工具并根据结构体定义生成相应的函数选项模式代码。内容如下所示：
```go
// Generated by go-option -type User; DO NOT EDIT
// If you have any questions, please create issues and submit contributions at:
// https://github.com/chenmingyong0423/go-optioner

package example

type UserOption func(*User)

func NewUser(name string, opts ...UserOption) *User {
	user := &User{
		Name: name,
	}

	for _, opt := range opts {
		opt(user)
	}

	return user
}

func WithAge(age int) UserOption {
	return func(user *User) {
		user.Age = age
	}
}

func WithGender(gender string) UserOption {
	return func(user *User) {
		user.Gender = gender
	}
}

```
`optioner` 工具将会生成一个名为 `opt_xxx_gen.go` 的文件，其中 `xxx` 是结构体的名称，例如 `opt_user_gen.go`。该文件包含生成的函数选项代码，用于初始化结构体和设置结构体字段的值。
# 如何贡献
我非常欢迎其他人对这个项目做出贡献！如果你有任何问题、改进建议或发现了 bug，请通过提交 issue 来与我们交流。如果你想提交代码贡献，请按照以下步骤：

1、`Fork` 这个仓库并克隆到本地。

2、创建一个新的分支：`git checkout -b feature/your-feature`。

3、在你的分支上进行修改或添加新功能。

4、提交你的更改：`git commit -m "描述你的修改"`

5、推送到你的 `Fork` 仓库：`git push origin feature/your-feature`

6、创建 `Pull` 请求，将你的更改合并到主仓库。

请确保您的代码遵循项目的编码风格并通过测试。
# 许可证
这个项目遵循 [Apache License](https://github.com/chenmingyong0423/go-optioner/blob/main/LICENSE) 许可。
# 联系我们
如果你有任何问题或意见，可以通过以下方式联系我们：
- 邮件：[chenmingyong5873@126.com]
- GitHub：[https://github.com/chenmingyong0423]
